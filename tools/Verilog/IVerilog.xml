<?xml version="1.0" encoding="UTF-8"?>
<!--iverilog -Dlegacy_model -gno-specify -v -o x353mjpeg_test -sglbl -stestbench353 
	-y./unisims -y. x353_1.tf glbl.v -->
<vdt-project>

	<interface name="IVerilog" extends="project_interface">
		<!-- Syntax definitions -->
		<syntax name="BoolParamSyntax" format="-%%ParamName" />
		<syntax name="InputPatternSyntax" format="’%%ParamValue’" />

		<typedef name="ModuleLibraryType" list="true">
			<paramtype kind="string" default="" textkind="dir"
				maxlength="256" sensitivity="sensitive" />
		</typedef>






		<syntax name="D_ParamSyntax" format="-D%%ParamName" />
		<syntax name="g_ParamSyntax" format="-g%%ParamName" />

		<typedef name="LegacyModelType">
			<paramtype kind="bool" formatTrue="-Dlegacy_model"
				formatFalse="" />
		</typedef>
		<typedef name="NoSpecifyType">
			<paramtype kind="bool" formatTrue="-gno-specify"
				formatFalse="" />
		</typedef>


		<!-- Actually used -->
		<syntax name="JustValueSyntax" format="%%ParamValue"></syntax>
		<syntax name="TopModuleSyntax" format="-s%%TopModule" />
		<syntax name="TopModulesOtherSyntax" format="%(-s%%ParamValue%| %)" />
		<syntax name="ModuleLibrarySyntax" format="%(-y%%ParamValue%| %)" />
		<syntax name="SourceListSyntax" format="%(%%SourceList%| %)" />
		<syntax name="ExtraFilesSyntax" format="%(%%ParamValue%| %)" />
		<syntax name="exeFileSyntax" format="%%ParamValue" />
		<syntax name="SwitchSyntax" format="-%%ParamName" />

		<syntax name="DbgCurrentFileSyntax" format="echo &quot;%%CurrentFile&quot; ;" />
		<syntax name="DbgChosenActionIndexSyntax" format="echo &quot;index=%%ChosenActionIndex&quot; ;" />
		<syntax name="BuildStampSyntax" format="%%BuildStamp" />

		<syntax name="GrepFindSyntax"
			format="| { grep --line-buffered -E &quot;%%ParamValue&quot; || true; }" />
		<syntax name="GrepSkipSyntax"
			format="| { grep --line-buffered -v &quot;%%ParamValue&quot; || true; }" />
		<syntax name="LogFileSyntax" format="%%ParamValue-%%BuildStamp.log" />
		<syntax name="OutputFileSyntax" format="%%ParamValue-%%BuildStamp.ivlg" />

		<syntax name="LxtFileSyntax" format="%%ParamValue-%%BuildStamp.lxt" />
		<syntax name="LxtParamFileSyntax"
			format="parameter lxtname=&quot;%%ParamValue-%%BuildStamp.lxt&quot;;" />
		<!-- <syntax name="LxtParamFileSyntax" format="parameter lxtname=%%ParamValue;" 
			/> -->
		<syntax name="IncludeParamSyntax" format="%(%%ParamValue%|\n%)" />


		<!-- typedef -->

		<typedef name="ExtraFilesType" list="true">
			<paramtype kind="string" textkind="file" maxlength="256"
				sensitivity="sensitive" />
		</typedef>

		<typedef name="exeType">
			<paramtype kind="string" maxlength="256" sensitivity="sensitive"
				textkind="file" />
		</typedef>

		<typedef name="SwitchType">
			<paramtype kind="bool" formatTrue="-%%ParamName"
				formatFalse="" />
		</typedef>
		<!-- <typedef name= "StringType" list="true"> <paramtype kind="string" 
			textkind="text" maxlength="256" sensitivity="sensitive"/> </typedef> -->

	</interface>
	<!-- <project name="IVerilogProject" label="iverilog project label" interface="IVerilog"> 
		</project> -->
	<project name="project_settings" label="Project parameters for project_settings"
		interface="project_interface">

		<parameter id="SimulationTopFile" label="Project top simulation file"
			type="FileType" default="default_top (testing)" format="ValueSyntax"
			readonly="false" />

		<parameter id="SimulationTopModule" label="Project top simulation module"
			type="StringType" default="" format="ValueSyntax" readonly="false" />

		<parameter id="BuildDir" label="project build directory"
			type="DirType" default="build" format="ValueSyntax" readonly="false" />

		<input>
			<group name="General" label="Project properties">
				"SimulationTopFile"
				"SimulationTopModule"
				"BuildDir"
			</group>
		</input>
		<output>
		</output>
	</project>



	<tool name="iverilog" project="project_settings" label="Icarus Verilog compiler"
		exe="iverilog" shell="?%%OS: Windows=shell:, Linux=/bin/bash"

		interface="IVerilog" errors="(.*):([0-9]+): [a-z_\- ]*error: (.*)"
		warnings="(.*):([0-9]+): [a-z_\- ]*warning: (.*)" info="(.*):([0-9]+): [a-z_\-  ]*info: (.*)"> <!--does not actually exist -->

		<extensions-list>
			<extension mask="v" />
			<extension mask="tf" />
		</extensions-list>

		<action-menu>
			<action label="Simulate" resource="%SimulationTopFile"
				check-extension="false" check-existence="true" icon="iverilog.ico" />
			<action label="Simulate for" resource="%%SelectedFile"
				check-extension="true" check-existence="true" />
			<action label="Verify" resource="%%SelectedFile"
				check-extension="true" check-existence="true" icon="newmod_wiz.gif" />
			<action label="Empty" resource="" icon="sample.gif" />
			<action label="Just try for" resource="%%OS" />
		</action-menu>


		<parameter id="Param_Shell_Options" label="Param_Shell_Options"
			type="StringType" format="JustValueSyntax" default="-c" readonly="false"
			visible="true" />
		<!-- Intentional error: No, does not detect duplicates yet -->

		<parameter id="Param_PreExe" label="Param_PreExe" type="StringType"
			format="JustValueSyntax" default="" readonly="false" visible="true" />

		<parameter id="Param_Exe" label="Param_Exe" type="exeType"
			format="exeFileSyntax" default="/usr/bin/iverilog" readonly="false"
			visible="true" />

		<parameter id="Param_TopModule" label="Top module extracted from the chosen target file"
			type="StringType" format="TopModuleSyntax" default="%%TopModule"
			readonly="true" visible="true" />

		<parameter id="TopModulesOther" type="StringListType"
			format="TopModulesOtherSyntax" default="" omit=""
			label="Select top modules not referenced by the chosen target"
			readonly="false" visible="true" />

		<parameter id="ModuleLibrary" type="ModuleLibraryType"
			format="ModuleLibrarySyntax" default="" label="Select additional libraries to include"
			omit="" readonly="false" visible="true" />


		<parameter id="ExtraFiles" type="ExtraFilesType" format="ExtraFilesSyntax"
			default="" label="Select additional files to include" readonly="false"
			visible="true" />


		<parameter id="LegacyModel" outid="legacy_model" type="LegacyModelType"
			format="D_ParamSyntax" default="true" label="Use legacy model" />

		<parameter id="NoSpecify" outid="no-specify" type="NoSpecifyType"
			format="g_ParamSyntax" default="true" label="Use no-specify" />
		<!-- -->
		<!-- -->
		<parameter id="v" type="SwitchType" format="SwitchSyntax"
			default="true" label="Verbose" />

		<parameter id="Param_SourceList" label="Param_SourceList"
			type="StringListType" format="SourceListSyntax" default="" readonly="true"
			visible="true" />

		<parameter id="DbgCurrentFile" label="DbgCurrentFile" type="StringType"
			format="DbgCurrentFileSyntax" default="" readonly="false" visible="true" />

		<parameter id="ChosenActionIndex" label="ChosenActionIndex"
			type="StringType" format="DbgChosenActionIndexSyntax" default=""
			readonly="false" visible="true" />

		<parameter id="ShowNoProblem" type="BoolYesNo" format="None"
			default="false" label="Show output with no errors/warnings" />

		<parameter id="ShowWarnings" type="BoolYesNo" format="None"
			default="false" label="Show output warnings" />

		<parameter id="RemoveBugs" type="BoolYesNo" format="None"
			default="false" label="Remove buggy simulator output" />

		<parameter id="SaveLogsPreprocessor" type="BoolYesNo"
			format="None" default="false" label="Save simulator preprocessor log output" />

		<parameter id="SaveLogsSimulator" type="BoolYesNo" format="None"
			default="false" label="Save simulator log output" />

		<parameter id="ShowWaves" type="BoolYesNo" format="None"
			default="true" label="Show simulation result in waveform viewer" />

		<!-- Advanced Section -->


		<parameter id="LogFile" label="Simulator log file prefix"
			type="StringType" default="%%CurrentFileBase" format="LogFileSyntax"
			readonly="false" />
		<parameter id="OutFile" label="Simulator intermediate file prefix"
			type="StringType" default="%%CurrentFileBase" format="OutputFileSyntax"
			readonly="false" />
		<parameter id="LxtDumpFile" label="Simulator LXT dump file prefix"
			type="StringType" default="%%CurrentFileBase" format="LxtFileSyntax"
			readonly="false" />

		<parameter id="GTKWaveSavFile" label="GTKWave sav file"
			type="FileType" default="%%CurrentFileBase.sav" format="ValueSyntax"
			omit="" readonly="false" />



		<parameter id="GrepFindErr" label="Grep pattern for errors only"
			type="StringType" format="GrepFindSyntax" default="error" readonly="false"
			visible="true" />

		<parameter id="GrepFindErrWarn" label="Grep pattern for both errors and warnings"
			type="StringType" format="GrepFindSyntax" default="error|warning"
			readonly="false" visible="true" />

		<parameter id="GrepSkip1" label="Grep skip pattern" type="StringType"
			format="GrepSkipSyntax" default="(null)" readonly="false" visible="true" />

		<parameter id="Param_1" label="Param_1" type="StringType"
			format="JustValueSyntax" default="" omit="" readonly="false" visible="true" />

		<parameter id="Param_2" label="Param_2" type="StringType"
			format="JustValueSyntax" default="" omit="" readonly="false" visible="true" />

		<parameter id="Param_3" label="Param_3" type="StringType"
			format="JustValueSyntax" default="" omit="" readonly="false" visible="true" />

		<parameter id="Param_4" label="Param_4" type="StringType"
			format="JustValueSyntax" default="" omit="" readonly="false" visible="true" />

		<parameter id="IVerilogOther" label="Other IVerilog options"
			type="StringType" format="JustValueSyntax" default="" omit=""
			readonly="false" visible="true" />

		<parameter id="IncludeParametersList" type="StringListType"
			format="IncludeParamSyntax" default="" omit=""
			label="Verilog parameters definition to be included in the test fixture"
			readonly="false" visible="true" />
		<!-- Invisible parameters -->
		<parameter id="IVerilogActionIndex" type="StringType"
			format="JustValueSyntax" visible="false" default="%%ChosenActionIndex" />

		<parameter id="SourceList" type="StringListType" format="SourceListSyntax"
			default="" readonly="true" visible="false" />

		<parameter id="iverilog_include_file" type="FileType"
			default="IVERILOG_INCLUDE.v" format="JustValueSyntax" visible="false" />

		<parameter id="LxtDumpFileParameter" type="StringType"
			default="%LxtDumpFile" format="LxtParamFileSyntax" visible="false" />

		<input>
			<group name="files" label="Files">
				<!-- "SimulationTopFile" -->
				"Param_TopModule"
				"TopModulesOther"
				"ExtraFiles"
				"ModuleLibrary"
				"GTKWaveSavFile"
				"IncludeParametersList"
			</group>
			<group name="options" label="Options">
				"ShowWaves"
				"ShowNoProblem"
				"ShowWarnings"
				"RemoveBugs"
				"SaveLogsPreprocessor"
				"SaveLogsSimulator"
				"v"
				"LegacyModel"
				"NoSpecify"
			</group>
			<group name="Advanced" label="Advanced">
				"Param_PreExe"
				"Param_Exe"
				"Param_Shell_Options"
				"IVerilogOther"
				"LogFile"
				"OutFile"
				"LxtDumpFile"
				"GrepFindErr"
				"GrepFindErrWarn"
				"GrepSkip1"
				"Param_1"
				"Param_2"
				"Param_3"
				"Param_4"
			</group>
		</input>
		<output>
			<line name="command_line" sep=" ">
				"%Param_Shell_Options"
				"%Param_PreExe"
				"trap 'killall iverilog; ' EXIT;"
				"echo 'current PID='$$;"
				"%Param_Exe"
				"-o"
				<if IVerilogActionIndex="2">
					"/dev/null"
				</if>
				<if-not IVerilogActionIndex="2">
					"%OutFile"
				</if-not>
				" -D IVERILOG"
				"%IVerilogOther"
				"%Param_TopModule"
				"%TopModulesOther"
				"%ModuleLibrary"
				"%LegacyModel"
				"%NoSpecify"
				"%v"
				"%SourceList"
				"%ExtraFiles"
				<if ShowNoProblem="false">
					"2&gt;&amp;1"
				</if>
				<if SaveLogsPreprocessor="true">
					"| tee"
					"%LogFile"
				</if>
				<if ShowNoProblem="false">
					<if ShowWarnings="true">
						"%GrepFindErrWarn"
					</if>
					<if ShowWarnings="false">
						"%GrepFindErr"
					</if>
					<if RemoveBugs="true">
						"%GrepSkip1"
					</if>
				</if>
				"|| { echo '*** iverilog failed ***'; exit 1; } ;"
				"trap '' EXIT;"
				<if-not IVerilogActionIndex="2">
					<!-- "time vvp -v" -->
					"%Param_1"
					"trap 'killall vvp; ' EXIT;"
					"vvp -v"
					"%Param_2"
					"%OutFile"
					"-lxt2 "
					<if SaveLogsSimulator="true">
						<if SaveLogsPreprocessor="true">
							"| tee -a"
							"%LogFile"
						</if>
						<if-not SaveLogsPreprocessor="true">
							"| tee"
							"%LogFile"
						</if-not>
					</if>


					"|| { echo '*** vvp failed ***'; exit 1; } ;"
					"trap '' EXIT;" <!-- no 
						trap for GTKWave -->
					<!-- "%Param_2" -->
					"%Param_3"
					<if ShowWaves="true">
						"gtkwave"
						"%LxtDumpFile"
						"%GTKWaveSavFile"
						"&amp;"
					</if>
					"%Param_4"
				</if-not>
			</line>
			<line name="IverilogIncludeFile" dest="iverilog_include_file"
				sep="\n">
				"%LxtDumpFileParameter"
				"%IncludeParametersList"
			</line>
		</output>


	</tool>
	<!-- "echo %SimulationTopFile %%CurrentFile ;" -->
	<!-- "-s counter_tb" "%SourceList" -->
	<!-- <parameter id = "xc_config_file" type = "Filename" default = "xc.cfg" 
		format = "Option" visible = "false" /> || { echo "iverilog failed"; exit 
		1; } ; time vvp -v x353mjpeg_test -lxt2 || { echo "vvp failed"; exit 1; } 
		; || { echo "iverilog failed"; exit 1; } time vvp -v x353mjpeg_test -lxt2 
		|| { echo "vvp failed"; exit 1; } gtkwave x353.lxt x353_1.sav & exit 0 -->


</vdt-project>
