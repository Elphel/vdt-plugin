<?xml version="1.0" encoding="UTF-8"?>

<vdt-project>
	<interface name="VivadoInterface" extends="FPGAPprojectInterface">
		<syntax name="GrepFilterProblemSyntax"        format='| grep --line-buffered -v  "\[%%ParamName"' />
		<syntax name="GrepFilterProblemOtherSyntax"   format='%(| grep --line-buffered -v  "\[%%ParamValue"%|\n%)' />
	
<!-- <syntax name="QuietSyntax"     format=" -quiet" />
		<syntax name="VerboseSyntax"   format=" -verbose" />
		<syntax name="DirectiveSyntax" format=" -directive %%ParamValue" /> -->
		
	
	<!-- 
		<syntax name="ProgramSyntax" format="%(%%ParamValue%|\n%)" />
		<syntax name="read_xdc_syntax" format="%(read_xdc %%ParamValue%|\n%)" /> -->
		
	</interface>
	<!--  Abstract tools to be inherited by instances used for various Vivado tools -->	
	<!--  Restore tool for Vivado -->
	<tool name="RestoreVivado" label="Restore state after Vivado tool"
	    project="FPGA_project"
		interface="VivadoInterface"
		package="FPGA_package"
		shell="/bin/bash"
		abstract="true">
		<output>
			<line name="vivado_pre_restore">
				"-c"
				<!-- Create project directory on remote server if it did not exist -->
				"ssh"
				"-oBatchMode=yes"
				"-l %RemoteUser %RemoteHost"
				"'"
				"mkdir -p"
				"%VivadoProjectRoot"
				"' ;"
				<!-- Copy snapshot generated after synthesis from local to remote -->
				"rsync -avrR -e ssh"
				<!--  from: -->
				"%VivadoLocalDir/%%StateFile"
				<!-- to: -->
				"%RemoteUser@%RemoteHost:%VivadoProjectRoot"
				";"
			</line>
			
			<line name="vivado_restore"
			      dest="VivadoConsole"
			      mark="``" 
			      sep=" "
			      failure="ERROR"
			      prompt="@@FINISH@@"
			      log="">
			      "cd ~/%VivadoProjectRoot\n"
			      "set outputDir ~/%VivadoProjectRoot/%VivadoRemoteDir\n"			      
			      "file mkdir $outputDir\n"
		          "open_checkpoint %VivadoRemoteDir/%%StateFile\n"
		          "puts \"@@FINISH@@\"\n"
		    </line>
		</output>
	</tool>

	<!--  Save tool for Vivado tool -->
	<tool name="SaveVivado"
	    label="SaveVivado"
	    project="FPGA_project"
		interface="VivadoInterface"
		package="FPGA_package"
		shell="/bin/bash"
		abstract="true">
		<output>
			<line name="vivado_save"
			      dest="VivadoConsole"
			      mark="``" 
			      sep=" "
			      prompt="@@FINISH@@"
			      failure="ERROR"
			      log="">
			      "cd ~/%VivadoProjectRoot\n"
			      "set outputDir ~/%VivadoProjectRoot/%VivadoRemoteDir\n"			      
			      "file mkdir $outputDir\n"
	      		  "write_checkpoint -force %VivadoRemoteDir/%%StateFile\n"
	      		  "puts \"@@FINISH@@\"\n"
			</line>
			<line name="vivado_copy_after_save">
					"-c"
					"mkdir -p %VivadoLocalDir ;"
					"rsync -avr -e ssh"
					"%RemoteUser@%RemoteHost:%VivadoProjectRoot/%VivadoRemoteDir/%%StateFile"
					"%%StateDir/"
			</line>
		</output>		
	</tool>
	
</vdt-project>
