<?xml version="1.0" encoding="UTF-8"?>
<!-- 
 /*******************************************************************************
 * Copyright (c) 2014 Elphel, Inc.
 * This file is a part of Eclipse/VDT plug-in.
 * Eclipse/VDT plug-in is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Eclipse/VDT plug-in is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *******************************************************************************/
 -->
<vdt-project>
  <interface name = "GREPInterface">
    <typedef name = "PatternTypeType">
        <paramtype kind = "enum" base = "String">
            <item label = "Fixed"           value = "fixed-strings"/>
            <item label = "Basic regexp"    value = "basic-regexp"/>
            <item label = "Extended regexp" value = "extended-regexp"/>
        </paramtype>
    </typedef>

    <typedef name = "BinaryFilesType">
        <paramtype kind = "enum" base = "String">
            <item label = "Text"     value = "text"/>
            <item label = "Binary"   value = "binary"/>
            <item label = "No match" value = "without-match"/>
        </paramtype>
    </typedef>

    <typedef name = "DirsType">
        <paramtype kind = "enum" base = "String">
            <item label = "Read"    value = "read"/>
            <item label = "Recurse" value = "recurse"/>
            <item label = "Skip"    value = "skip"/>
        </paramtype>
    </typedef>
    
    <typedef name = "OutputOnlyType">
        <paramtype kind = "enum" base = "String">
            <item label = "Matched lines"     value = ""/>
            <item label = "Matched files"     value = "files-with-match"/>
            <item label = "Non-matched files" value = "files-without-matches"/>
        </paramtype>
    </typedef>

    <typedef name = "PrintFilenameType">
      <paramtype kind="bool" 
                 formatTrue="with-filename"
                 formatFalse="no-filename" />
    </typedef>
        
    <syntax name = "EquationParamSyntax"
            format = "--%%ParamName=%%ParamValue"/>

    <syntax name = "BoolParamSyntax"
            format = "--%%ParamName"/>

    <syntax name = "EnumParamSyntax"
            format = "--%%ParamValue"/>

    <syntax name = "InputPatternSyntax"
            format = "'%%ParamValue'"/>
  </interface>

  <tool name        = "grep"
        label       = "GREP tool"
        interface   = "GREPInterface"
        description = "Find a text in source files" exe="grep">

    <parameter id      = "pattern"
               type    = "String"
               format  = "InputPatternSyntax"
               default = ""
               label   = "Pattern to match"/>

    <parameter id      = "pattern_type"
               outid   = "pattern-type"
               type    = "PatternTypeType"
               format  = "EnumParamSyntax"
               default = "fixed-strings"
               omit    = "fixed-strings"
               label   = "Pattern type"/>
               
    <parameter id      = "word_regexp"
               outid   = "word-regexp"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Match only whole words"/>

    <parameter id      = "line_regexp"
               outid   = "line-regexp"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Match only whole lines"/>

    <parameter id      = "ignore_case"
               outid   = "ignore-case"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Ignore case distinctions"/>

    <parameter id      = "invert_match"
               outid   = "invert-match"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Print non-matching lines"/>

    <parameter id      = "no_messages"
               outid   = "no-messages"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Suppress error messages"/>

    <parameter id      = "print_filename"
               type    = "PrintFilenameType"
               format  = "EnumParamSyntax"
               default = "true"
               omit    = "true"
               label   = "Print the filename for each match"/>

    <parameter id      = "binary_files"
               outid   = "binary-files"
               type    = "BinaryFilesType"
               format  = "EquationParamSyntax"
               default = "without-match"
               omit    = "without-match"
               label   = "Binary files type"/>
    
    <parameter id      = "byte_offset"
               outid   = "byte-offset"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Print the byte offset with output lines"/>

    <parameter id      = "line_number"
               outid   = "line-number"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Print line number with output lines"/>

    <parameter id      = "directories"
               type    = "DirsType"
               format  = "EquationParamSyntax"
               default = "recurse"
               omit    = "recurse"
               label   = "Action for handling directories"/>

    <parameter id      = "output_only"
               outid   = "output-only"
               type    = "OutputOnlyType"
               format  = "EquationParamSyntax"
               default = ""
               omit    = ""
               label   = "At the match, print only"/>

    <parameter id      = "count"
               type    = "BoolOnOff"
               format  = "BoolParamSyntax"
               default = "false"
               omit    = "false"
               label   = "Only print a count of matching lines per file"/>

    <parameter id      = "before_context"
               outid   = "before-context"
               type    = "Cardinal"
               format  = "EquationParamSyntax"
               default = "0"
               omit    = "0"
               label   = "Number of lines of leading context to print"/>

    <parameter id      = "after_context"
               outid   = "after-context"
               type    = "Cardinal"
               format  = "EquationParamSyntax"
               default = "0"
               omit    = "0"
               label   = "Number of lines of trailing context to print"/>

    <input label="GREP Preferences">
      <group label="Match">
        "pattern"
        "pattern_type"
        "word_regexp"
        "line_regexp"
        "ignore_case"
        "invert_match"
      </group>
      <group label="Output">
        "no_messages"
        "print_filename"
        "binary_files"
        "byte_offset"
        "line_number"
        "directories"
        "output_only"
        "count"
        "before_context"
        "after_context"
      </group>
    </input>

    <output>
      <line name = "command_line" sep = " ">
        "%pattern_type"
        "%word_regexp"
        "%line_regexp"
        "%ignore_case"
        "%invert_match"
        "%no_messages"
        "%print_filename"
        "%binary_files"
        "%byte_offset"
        "%line_number"
        "%directories"
        "%output_only"
        "%count"
        "%before_context"
        "%after_context"
        "%pattern"
        "%(%%FileList%| %)"
      </line>
    </output>
  </tool>
</vdt-project>
