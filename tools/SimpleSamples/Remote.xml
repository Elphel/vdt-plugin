<?xml version="1.0" encoding="UTF-8"?>

<vdt-project>
	<interface name="RemoteInterface" extends="FPGAPprojectInterface">
<!-- 		<syntax name="ProgramSyntax" format="%(%%ParamValue%|\n%)" />  -->
	</interface>
	<tool name="RemotePython" project="FPGA_project" label="RemotePython"
	    package="FPGA_package"
		shell="/bin/bash" interface="RemoteInterface" description="Launching remote Python in console"
		errors="(.*):([0-9]+): [a-z ]*error: (.*)" warnings="(.*):([0-9]+): warning: (.*)"
		info="(.*):([0-9]+): info: (.*)"> <!--does not actually exist -->
		<extensions-list>
			<extension mask="v" />
			<extension mask="tf" />
		</extensions-list>

		<action-menu>
			<action label="Remote Python" resource="" icon="python.png" />
		</action-menu>

		<parameter id="RemoteHost" label="Remote Host IP" type="String"
			format="CopyValue" default="192.168.0.66" readonly="false" visible="true" />


		<parameter id="RemoteUser" label="Remote user name" type="String"
			format="CopyValue" default="" readonly="false" visible="true" />

		<parameter id="PreSSH" label="pre-ssh shell parameters"
			type="String" format="CopyValue" default="" readonly="false" visible="true" />

		<parameter id="ShellSwitches" label="Shell switches" type="String"
			format="CopyValue" default="-c" readonly="false" visible="true" />

		<parameter id="TerminalMode" type="BoolYesNo" format="None"
			default="false" label="Force termonal mode for remote program" />

		<parameter id="SSHSwitches" label="Other ssh switches"
			type="String" format="CopyValue" default="" readonly="false" visible="true" />

		<parameter id="RemoteCommand" label="Remote ssh command"
			type="String" format="CopyValue" default="python -i -u" readonly="false"
			visible="true" />

		<parameter id="SSHExtra" label="ssh extra parameters" type="String"
			format="CopyValue" default="" readonly="false" visible="true" />
			
		<parameter id="PythonConsole" default="RemotePython" type="String" format="CopyValue" visible="false"/>
			

		<input>
			<group name="General">
				"RemoteHost"
				"RemoteUser"
				"TerminalMode"
				"ShellSwitches"
				"PreSSH"
				"SSHSwitches"
				"RemoteCommand"
				"SSHExtra"
			</group>
		</input>

		<output>
			<line name="command_line"
			      timeout="1"
				  keep-open= "true">
				"%ShellSwitches"
				"%PreSSH"
				"ssh"
				<if TerminalMode = "true">
				  "-t -t"
				</if>
				"%SSHSwitches"
				"-l"
				"%RemoteUser"
				"%RemoteHost"
				"'"
				"%RemoteCommand"
				"'"
				"%SSHExtra"
			</line>
			<line name="python_check"
			      dest="PythonConsole"
			      mark="``" 
			      sep=""
			      success="FINISH"
			      prompt="@@FINISH@@">
				  "print (\"********\")\n"
				  "print (\"@@FINISH@@\")\n\n"
			</line>
			
		</output>
	</tool>
	<tool name="RemotePythonCommand" project="FPGA_project" label="RemotePythonCommand"
	    package="FPGA_package"
		shell="bash" interface="RemoteInterface"
		description="Sending command to a ermote Python session" errors="(.*):([0-9]+): [a-z ]*error: (.*)"
		warnings="(.*):([0-9]+): warning: (.*)" info="(.*):([0-9]+): info: (.*)"> <!--does not actually exist -->
		<extensions-list>
			<extension mask="v" />
			<extension mask="tf" />
		</extensions-list>

		<action-menu>
			<action label="Remote Python Command" resource="" icon="python.png" />
		</action-menu>

		<parameter id="RemoteCommand" label="Remote Command to send"
			type="Stringlist" format="ProgramSyntax" default="print &quot;Hello, World!, 2*2=&quot;,2*2"
			readonly="false" visible="true" />

		<parameter id="python_console_name" default="RemotePython"
			type="String" format="CopyValue" visible="false" />
			
			
	   <parameter id="Timeout" label="Script timeout(sec)" type="Cardinal"
			format="CopyValue" default="10" readonly="false" visible="true" />
			

		<input>
			<group name="General">
				"RemoteCommand"
				"Timeout"
			</group>
		</input>

		<output>
			<line name="command_line_01">
				"-c"
				"echo 'Nothing to do, sleeping 5' ;"
				"sleep 5 ;"
				"echo 'Nothing to do, awakening' ;"
			</line>
			<!--  prompt: recognizer should trim spaces too -->
			<!--  stdout - both with stderr, stderr only ..., both to the same - to separate console instances -->
			<line name="console_line_01"
			      dest="python_console_name"
			      mark="``" 
			      sep="\n"
			      prompt="@@FINISH@@" 
			      stdout="parser_001"
			      success="FINISH"
			      timeout="Timeout">
				"%RemoteCommand"
				"print  '@@FINISH@@'"
				"``"`" <!-- two new lines should generate a pair of prompts from the remote -->
			</line>
			<line name="command_line_02">
				"-c"
				"echo 'Nothing to do second time, sleeping 10' ;"
				"sleep 10 ;"
				"echo 'Nothing to do again, awakening after sleep 10' ;"
			</line>
<!-- parser_01 being referenced should be launched in an asynchronous process/console, removed from the launch sequence -->
			<line name="parser_001"
			    errors="(.*):([0-9]+): [a-z ]*error: (.*)"
				warnings="(.*):([0-9]+): warning: (.*)"
				info="(.*):([0-9]+): info: (.*)">
				"-c"
				"grep --line-buffered 'End'"
			</line>

		</output>

	</tool>
</vdt-project>
<!--   /opt/Xilinx/Vivado/2013.4/bin/vivado -mode tcl -->